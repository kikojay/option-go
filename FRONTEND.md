## ğŸ“± å‰ç«¯æ¶æ„ä¸æ˜¾ç¤ºè¯´æ˜

### ğŸ¯ ä½¿ç”¨çš„æŠ€æœ¯æ ˆ

- **Streamlit**: Python æ•°æ®åº”ç”¨æ¡†æ¶ï¼ˆWeb UIï¼‰
- **Plotly**: äº¤äº’å¼å›¾è¡¨åº“
- **Pandas**: æ•°æ®å¤„ç†
- **SQLAlchemy**: æ•°æ®åº“ORM

---

### ğŸš€ ä¸¤ä¸ªç‰ˆæœ¬è¯´æ˜

#### **app.py** (v1 - åŸºç¡€ç‰ˆ)
```python
# åŸºç¡€åŠŸèƒ½å®ç°
- äº¤æ˜“å½•å…¥
- å•ä¸ªæŒä»“åˆ†æ
- ç®€å•å›¾è¡¨æ˜¾ç¤º
```

**å¯åŠ¨**:
```bash
streamlit run app.py
```

#### **app_v2.py** (v2 - å®Œæ•´ç‰ˆ â­)
```python
# å®Œæ•´åŠŸèƒ½
- å¤šè´¦æˆ·æ”¯æŒ
- å¤šå¸ç§è½¬æ¢
- æ•°æ®å¿«ç…§å†å²
- å¹´åº¦æ€»ç»“
- å®Œæ•´çš„ç»„åˆåˆ†æ
```

**å¯åŠ¨**:
```bash
streamlit run app_v2.py
```

---

### ğŸ“Š å‰ç«¯é¡µé¢ç»“æ„ï¼ˆv2ï¼‰

```
ğŸ’° è´¢å¯Œè¿½è¸ªå™¨
â”‚
â”œâ”€â”€ ğŸ“ˆ ä»ªè¡¨æ¿ (Dashboard)
â”‚   â”œâ”€â”€ å…³é”®æŒ‡æ ‡å¡ç‰‡ (Metrics)
â”‚   â”‚   â”œâ”€â”€ æ€»èµ„äº§
â”‚   â”‚   â”œâ”€â”€ å·²å®ç°ç›ˆäº
â”‚   â”‚   â”œâ”€â”€ æµ®åŠ¨ç›ˆäº
â”‚   â”‚   â””â”€â”€ æ€»ç›ˆäº
â”‚   â”œâ”€â”€ èµ„äº§é…ç½®é¥¼å›¾ (Allocation)
â”‚   â”œâ”€â”€ æŒä»“è¯¦æƒ…è¡¨æ ¼ (Holdings Table)
â”‚   â””â”€â”€ ç›ˆäºåˆ†è§£å›¾è¡¨ (P&L Breakdown)
â”‚
â”œâ”€â”€ ğŸ“ äº¤æ˜“è®°å½• (Transactions)
â”‚   â”œâ”€â”€ äº¤æ˜“è¡¨æ ¼
â”‚   â”œâ”€â”€ æœç´¢è¿‡æ»¤
â”‚   â””â”€â”€ å¯¼å…¥å¯¼å‡º
â”‚
â”œâ”€â”€ ğŸ¯ ç­–ç•¥ç®¡ç† (Strategies)
â”‚   â”œâ”€â”€ æ´»è·ƒç­–ç•¥åˆ—è¡¨
â”‚   â”œâ”€â”€ å·²å…³é—­ç­–ç•¥
â”‚   â””â”€â”€ ç­–ç•¥è¯¦æƒ…
â”‚
â”œâ”€â”€ ğŸ’± è´¦æˆ·ç®¡ç† (Accounts)
â”‚   â”œâ”€â”€ è´¦æˆ·åˆ—è¡¨
â”‚   â”œâ”€â”€ ä½™é¢è¿½è¸ª
â”‚   â””â”€â”€ è´¦æˆ·è®¾ç½®
â”‚
â”œâ”€â”€ ğŸ“‹ åˆ†ææŠ¥å‘Š (Analytics)
â”‚   â”œâ”€â”€ è¡¨ç°åˆ†æ
â”‚   â”‚   â”œâ”€â”€ æƒåˆ©é‡‘æ•ˆç‡
â”‚   â”‚   â”œâ”€â”€ å¤šæ ·åŒ–åˆ†æ
â”‚   â”‚   â””â”€â”€ é£é™©æŒ‡æ ‡
â”‚   â”œâ”€â”€ å†å²æ•°æ®
â”‚   â””â”€â”€ è¯¦ç»†æŠ¥å‘Š
â”‚
â””â”€â”€ âš™ï¸ è®¾ç½® (Settings)
    â”œâ”€â”€ æ•°æ®å¤‡ä»½
    â”œâ”€â”€ æ•°æ®å¯¼å…¥
    â””â”€â”€ ç³»ç»Ÿè®¾ç½®
```

---

### ğŸ’» ä½¿ç”¨ç¤ºä¾‹

#### **1. å¯åŠ¨åº”ç”¨**

```bash
# æ–¹æ³•1: ä½¿ç”¨v2ç‰ˆæœ¬ï¼ˆæ¨èï¼‰
streamlit run app_v2.py

# æ–¹æ³•2: ä½¿ç”¨v1åŸºç¡€ç‰ˆæœ¬
streamlit run app.py
```

è®¿é—®: `http://localhost:8501`

#### **2. æ·»åŠ äº¤æ˜“**

åœ¨åº”ç”¨ä¸­é€‰æ‹©ã€ŒğŸ“ äº¤æ˜“è®°å½•ã€ï¼Œæ·»åŠ ï¼š

```
æ—¥æœŸ: 2026-01-01
ç±»å‹: æœŸæƒ
å­ç±»å‹: Sell Put
è‚¡ç¥¨: AAPL
è¡Œæƒä»·: 180
æƒåˆ©é‡‘: -100 (æ”¶å…¥)

æˆ–è€…

æ—¥æœŸ: 2026-01-02
ç±»å‹: è‚¡ç¥¨
å­ç±»å‹: Buy
è‚¡ç¥¨: AAPL
æ•°é‡: 100
ä»·æ ¼: 150
é‡‘é¢: 15000
```

#### **3. æŸ¥çœ‹ä»ªè¡¨æ¿**

ä»ªè¡¨æ¿è‡ªåŠ¨æ˜¾ç¤ºï¼š

```
ğŸ’° ğŸ’¼ èµ„äº§æƒ…å†µ
  æ€»å¸‚å€¼: $45,230
  å·²å®ç°ç›ˆäº: $1,200
  æµ®åŠ¨ç›ˆäº: $890
  æ€»ç›ˆäº: $2,090

ğŸ“Š èµ„äº§é…ç½®
  AAPL: 45%
  SLV: 35%  
  ç°é‡‘: 20%

ğŸ’¡ åˆ†ææŠ¥å‘Š
  æƒåˆ©é‡‘æ•ˆç‡: æ¯æŠ•å…¥ $100 æˆæœ¬ï¼Œå·²æ”¶ $12.50 æƒåˆ©é‡‘
  é£é™©ç­‰çº§: ä¸­ç­‰
  å»ºè®®: å¢åŠ å¤šæ ·åŒ–æŒä»“
```

---

### ğŸ¨ å‰ç«¯æ•°æ®æµ

```
ç”¨æˆ·æ“ä½œ (UI)
    â†“
Streamlit App (app_v2.py)
    â†“
PortfolioDashboard ç»„ä»¶
    â†“
â”œâ”€ PortfolioCalculator (æ±‡æ€»)
â”‚  â””â”€ WheelStrategyCalculator (å•ä¸ªæŒä»“)
â”‚
â”œâ”€ PortfolioAnalyzer (åˆ†æ)
â”‚  â””â”€ é£é™©/è¡¨ç°æŒ‡æ ‡
â”‚
â””â”€ å›¾è¡¨æ¸²æŸ“
   â”œâ”€ plot_cost_basis_over_time (Plotly)
   â”œâ”€ plot_portfolio_allocation
   â”œâ”€ plot_campaign_pnl
   â””â”€ plot_premium_history
    â†“
æ˜¾ç¤ºåœ¨ Web ç•Œé¢
```

---

### ğŸ” æ•°æ®æº

#### **æœ¬åœ°æ•°æ®åº“**
```
data/
â””â”€â”€ wealth.db (SQLite)
   â”œâ”€â”€ accounts
   â”œâ”€â”€ accounts_categories
   â”œâ”€â”€ transactions
   â”œâ”€â”€ campaigns
   â”œâ”€â”€ campaign_transactions
   â””â”€â”€ daily_prices
```

#### **å®æ—¶æ•°æ®** (app_v2.py)
```
- stocks_symbols: è‚¡ç¥¨ä»£ç 
- daily_prices: æ¯æ—¥ä»·æ ¼
- exchange_rates: æ±‡ç‡
```

---

### ğŸ“Š å…³é”®é¡µé¢ä»£ç ç¤ºä¾‹

#### **ä»ªè¡¨æ¿é¡µé¢**

```python
import streamlit as st
from src.visualization import PortfolioDashboard
from src.database_v2 import get_transactions, convert_to_rmb

# é¡µé¢é…ç½®
st.set_page_config(page_title="ğŸ’° è´¢å¯Œè¿½è¸ªå™¨", layout="wide")

# è·å–æ•°æ®
transactions = get_transactions()
prices = fetch_current_prices()

# åˆ›å»ºä»ªè¡¨æ¿
dashboard = PortfolioDashboard(transactions, prices)

# æ¸²æŸ“
dashboard.render_full_dashboard()
```

#### **äº¤æ˜“å½•å…¥é¡µé¢**

```python
st.title("ğŸ“ æ·»åŠ äº¤æ˜“")

col1, col2 = st.columns(2)

with col1:
    date = st.date_input("äº¤æ˜“æ—¥æœŸ")
    tx_type = st.selectbox("äº¤æ˜“ç±»å‹", ["è‚¡ç¥¨", "æœŸæƒ", "æ”¯å‡º", "æ”¶å…¥"])

with col2:
    symbol = st.text_input("è‚¡ç¥¨ä»£ç ")
    amount = st.number_input("é‡‘é¢")

if st.button("ä¿å­˜"):
    add_transaction(Transaction(...))
    st.success("äº¤æ˜“å·²ä¿å­˜ï¼")
```

#### **åˆ†ææŠ¥å‘Šé¡µé¢**

```python
st.title("ğŸ“‹ åˆ†ææŠ¥å‘Š")

analyzer = PortfolioAnalyzer(transactions)
summary = analyzer.get_performance_summary(prices)

# æƒåˆ©é‡‘æ•ˆç‡
st.metric("æƒåˆ©é‡‘æ•ˆç‡", f"{summary['premium_efficiency']['efficiency_pct']:.2f}%")

# å¤šæ ·åŒ–
st.write(f"æŒä»“å“ç§: {summary['diversification']['symbol_count']}")
st.write(summary['diversification']['recommendation'])

# é£é™©
st.gauge(
    label="é£é™©ç­‰çº§",
    value=summary['risk']['max_drawdown_pct'],
    min_value=-50,
    max_value=0
)
```

---

### ğŸ¯ æ˜¾ç¤ºçš„å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | æ¥æº | è¯´æ˜ |
|------|------|------|
| **è°ƒæ•´æˆæœ¬åŸºå‡†** | `WheelStrategyCalculator` | æ¯è‚¡å®é™…æˆæœ¬ï¼ˆå«æƒåˆ©é‡‘ï¼‰ |
| **æƒåˆ©é‡‘æ•ˆç‡** | `PortfolioAnalyzer` | æƒåˆ©é‡‘ / æˆæœ¬åŸºå‡† Ã— 100 |
| **å·²å®ç°ç›ˆäº** | `WheelStrategyCalculator` | æˆäº¤è‚¡ç¥¨çš„ç›ˆäº + æœŸæƒæ”¶ç›Š |
| **æµ®åŠ¨ç›ˆäº** | `WheelStrategyCalculator` | å½“å‰å¸‚å€¼ - æˆæœ¬åŸºå‡† |
| **æ€»ç›ˆäº** | å·²å®ç° + æµ®åŠ¨ | å®Œæ•´P&L |
| **èµ„äº§é…ç½®** | å„æŒä»“å æ¯” | å¸‚å€¼åˆ†é…æ¯”ä¾‹ |
| **é£é™©ç­‰çº§** | æœ€å¤§å›æ’¤ | ä½/ä¸­/é«˜ |
| **å›æœ¬å‘¨æ•°** | æœŸæƒå‘¨æœŸåˆ†æ | éœ€å‡ å‘¨å®Œå…¨å›æœ¬ |

---

### ğŸ”„ å®æ—¶æ›´æ–°

v2 æ”¯æŒå®æ—¶æ•°æ®æ›´æ–°ï¼š

```python
# è‡ªåŠ¨åˆ·æ–°é—´éš”
st.set_page_config(..., initial_sidebar_state="expanded")

# å®æ—¶ä»·æ ¼æ›´æ–°
if st.button("åˆ·æ–°ä»·æ ¼"):
    prices = fetch_latest_prices()
    st.rerun()

# å®šæ—¶è‡ªåŠ¨åˆ·æ–°ï¼ˆå¯é€‰ï¼‰
auto_refresh = st.checkbox("è‡ªåŠ¨åˆ·æ–° (æ¯åˆ†é’Ÿ)")
if auto_refresh:
    import time
    time.sleep(60)
    st.rerun()
```

---

### ğŸ“± å“åº”å¼è®¾è®¡

æ‰€æœ‰é¡µé¢åœ¨ä»¥ä¸‹è®¾å¤‡ä¸Šå·¥ä½œï¼š

- âœ… æ¡Œé¢æµè§ˆå™¨ (1920x1080+)
- âœ… å¹³æ¿ (768x1024)
- âœ… æ‰‹æœº (é€šè¿‡ Streamlit ç§»åŠ¨ä¼˜åŒ–)

---

### ğŸ™‹ ä½¿ç”¨å»ºè®®

1. **é¦–æ¬¡ä½¿ç”¨**: ä»ä»ªè¡¨æ¿å¼€å§‹äº†è§£å…¨å±€æƒ…å†µ
2. **å®šæœŸæ“ä½œ**: åœ¨ã€Œäº¤æ˜“è®°å½•ã€é¡µé¢æ·»åŠ æ¯æ¬¡äº¤æ˜“
3. **åˆ†æå†³ç­–**: æ¯å‘¨æŸ¥çœ‹ã€Œåˆ†ææŠ¥å‘Šã€äº†è§£æƒåˆ©é‡‘æ•ˆç‡å’Œé£é™©
4. **å®šæœŸå¤‡ä»½**: ä½¿ç”¨ã€Œè®¾ç½®ã€é¡µé¢å¤‡ä»½æ•°æ®

---

### ğŸ› æ•…éšœæ’é™¤

**é—®é¢˜**: å›¾è¡¨ä¸æ˜¾ç¤º
- **è§£å†³**: `pip install plotly==5.18.0`

**é—®é¢˜**: æƒé™é”™è¯¯
- **è§£å†³**: `chmod 755 data/wealth.db`

**é—®é¢˜**: æ•°æ®ä¸åŒæ­¥
- **è§£å†³**: é‡å¯åº”ç”¨æˆ–æ¸…é™¤ç¼“å­˜ `streamlit cache clear`

---

### ğŸ’¡ ä¸‹ä¸€æ­¥æ”¹è¿›

- [ ] æ·»åŠ å›¾è¡¨å¯¼å‡º (PDF/PNG)
- [ ] å®ç°ç»„åˆä¼˜åŒ–å»ºè®®
- [ ] æ·»åŠ  Email å®šæœŸæŠ¥å‘Š
- [ ] æ”¯æŒå¤šç”¨æˆ·å’Œæƒé™
